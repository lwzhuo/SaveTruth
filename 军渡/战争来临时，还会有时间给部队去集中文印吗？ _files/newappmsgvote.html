<!DOCTYPE html>
<!--headTrap<body></body><head></head><html></html>-->
<html><head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
        <title></title>
        
<link rel="stylesheet" href="newappmsgvote_data/page_mp_vote3de35e.css">
<link rel="stylesheet" href="newappmsgvote_data/page_mp_vote_new3ec992.css">

    </head>
    <body class="en_US " ontouchstart="">
        
<script id="t_votes" type="text/html">
    {if (del_flag==0)}
    <div class="vote_form_inner {if has_vote}has_vote{/if} {if (is_expired||!is_login)}expired{/if}">
        {if (!is_login)}
        <p class="vote_error_tips">
            <img src="http://mmbiz.qpic.cn/mmbiz/a5icZrUmbV8qLa7aVNndUPfGbulEZzxnibJIenSIdYk1faoKobuK70I9wWEXnGQjicG7L2LibJQCAPwMPP0IAvtY6g/0" alt="">很抱歉，请在手机微信登录投票
        </p>
		{else if (is_expired)}
		<div class=" vote_frm_top">
			<p class="vote_tips">投票已过期</p>
		</div>
		{/if}

        {each vote_subject as item idx}
		<div class="vote_form_ele{if idx+1==vote_count} vote_form_ele_last{/if}"  id="img-content">
			<h3 class="vote_title">{if vote_count>1}{idx+1}.{/if}{item.title}{if item.type==1}（单选）{else}（多选）{/if}</h3>

			<ul class="vote_option_list ">
				{each item.options as subitem subidx}
				<li class="vote_option">

					<input class="{if item.type==1}frm_radio{else}frm_checkbox{/if} js_vote" type="{if item.type==1}radio{else}checkbox{/if}" id="vote_{idx}_{subidx}" name="vote_{idx}" value="{subidx}" {if (has_vote || !is_login || is_expired )}disabled="disabled"{/if}>

					<label for="vote_{idx}_{subidx}" onclick="" class="{if item.type==1}frm_radio_label{else}frm_checkbox_label{/if} vote_option_title group">
						{if subitem.url}
						<div class="img_container img_container_label">
							<span class="img_panel">
                            {if subitem.url.indexOf("http://mmsns.qpic.cn")>-1}
                            <img class="preview" src="{subitem.url.replace(/\/0$/, '/0?wxfrom=101').replace(/\/0\?/, '/0?wxfrom=101&')}"/></span>
                            {else}
                            <img class="preview" src="{subitem.url.replace(/\/0$/, '/300?wxfrom=101').replace(/\/0\?/, '/300?wxfrom=101&')}"/></span>
                            {/if}
						</div>
                        {/if}
                        <span class="frm_option_word">{subitem.name} {if subitem.selected}(已选){/if}</span>
					</label>

					<div class="vote_result">
						<span class="vote_result_meta tips vote_number">{subitem.cnt}票</span>
						<span class="vote_result_meta tips vote_percent">{if item.total_cnt>0}{toFixed subitem.cnt*100/item.total_cnt}{else}0{/if}%</span>
						<div class="vote_result_meta vote_graph">
							<span style="width:{if item.total_cnt>0}{toFixed subitem.cnt*100/item.total_cnt}{else}0{/if}%;background-color:#7DADE1" class="vote_progress"></span>
						</div>
					</div>

					{if subitem.url}
					<div class="img_container img_container_btm">
						<span class="img_panel"><img class="preview" src="{subitem.url.replace(/\/0$/, '/300?wxfrom=101').replace(/\/0\?/, '/300?wxfrom=101&')}"/></span>
					</div>
					{/if}
				</li>
				{/each}
			</ul>
		</div>
        {/each}

			{if (!is_expired&&is_login)}
                {if !has_vote}
				<div class="vote_tool_area vote_tool_area_btn">
					<button id="js_btn" type="submit" class="btn btn_inline btn_primary btn_disabled">投票</button>
				</div>
                {else}
				<div class="vote_tool_area">
					<p class="vote_tips">你已投票</p>
				</div>
                {/if}
            {/if}

    </div>
    {/if}
</script>
<div id="js_form" action="javascript:return false;" class="vote_box form vote_form ">
    <div class="vote_form_inner  expired">
        
        <p class="vote_error_tips">
            <img src="newappmsgvote_data/0.png" alt="">很抱歉，请在手机微信登录投票
        </p>
		

        
		<div class="vote_form_ele vote_form_ele_last" id="img-content">
			<h3 class="vote_title">你支持集中打印吗？（单选）</h3>

			<ul class="vote_option_list ">
				
				<li class="vote_option">

					<input class="frm_radio js_vote" id="vote_0_0" name="vote_0" value="0" disabled="disabled" type="radio">

					<label for="vote_0_0" onclick="" class="frm_radio_label vote_option_title group">
						
                        <span class="frm_option_word">支持！有利于管理 </span>
					</label>

					<div class="vote_result">
						<span class="vote_result_meta tips vote_number">107票</span>
						<span class="vote_result_meta tips vote_percent">5%</span>
						<div class="vote_result_meta vote_graph">
							<span style="width:5%;background-color:#7DADE1" class="vote_progress"></span>
						</div>
					</div>

					
				</li>
				
				<li class="vote_option">

					<input class="frm_radio js_vote" id="vote_0_1" name="vote_0" value="1" disabled="disabled" type="radio">

					<label for="vote_0_1" onclick="" class="frm_radio_label vote_option_title group">
						
                        <span class="frm_option_word">反对！费时，费力 </span>
					</label>

					<div class="vote_result">
						<span class="vote_result_meta tips vote_number">1596票</span>
						<span class="vote_result_meta tips vote_percent">87%</span>
						<div class="vote_result_meta vote_graph">
							<span style="width:87%;background-color:#7DADE1" class="vote_progress"></span>
						</div>
					</div>

					
				</li>
				
				<li class="vote_option">

					<input class="frm_radio js_vote" id="vote_0_2" name="vote_0" value="2" disabled="disabled" type="radio">

					<label for="vote_0_2" onclick="" class="frm_radio_label vote_option_title group">
						
                        <span class="frm_option_word">无所谓 </span>
					</label>

					<div class="vote_result">
						<span class="vote_result_meta tips vote_number">124票</span>
						<span class="vote_result_meta tips vote_percent">6%</span>
						<div class="vote_result_meta vote_graph">
							<span style="width:6%;background-color:#7DADE1" class="vote_progress"></span>
						</div>
					</div>

					
				</li>
				
			</ul>
		</div>
        

			

    </div>
    </div>

        <script nonce="">
    var __DEBUGINFO = {
        debug_js : "//res.wx.qq.com/mmbizwap/en_US/htmledition/js/biz_wap/debug/console3a696a.js",
        safe_js : "//res.wx.qq.com/mmbizwap/en_US/htmledition/js/biz_wap/safe/moonsafe3a696a.js",
        res_list: []
    };
</script>

<script nonce="" type="text/javascript">
(function() {
	var totalCount = 0,
			finishCount = 0;

	function _loadVConsolePlugin() {
		window.vConsole = new window.VConsole();
		while (window.vConsolePlugins.length > 0) {
			var p = window.vConsolePlugins.shift();
			window.vConsole.addPlugin(p);
		}
	}
	
	function _addVConsole(uri, cb) {
		totalCount++;
		var url = '//res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/vconsole/' + uri;
		var node = document.createElement('SCRIPT');
		node.type = 'text/javascript';
		node.src = url;
		node.setAttribute('nonce', '');
		if (cb) {
			node.onload = cb;
		}
		document.getElementsByTagName('head')[0].appendChild(node);
	}
	if (
		(document.cookie && document.cookie.indexOf('vconsole_open=1') > -1)
		|| location.href.indexOf('vconsole=1') > -1
	) {
		window.vConsolePlugins = [];
		_addVConsole('3.0.0/vconsole.min.js', function() {
			
			_addVConsole('plugin/vconsole-mpopt/1.0.1/vconsole-mpopt.js', _loadVConsolePlugin);
		});
	}
})();
</script>
        
<script type="text/javascript" src="newappmsgvote_data/zepto3a696a.js"></script>
<script type="text/javascript" src="newappmsgvote_data/template3a696a.js"></script>
<script type="text/javascript">
    
    var biz = "MzUxMTAxODE5NA==";
    var appmsg_token = "";
    if(!!appmsg_token){
        (new Image()).src = location.protocol + "//mp.weixin.qq.com/mp/jsmonitor?idkey=68064_9_1&r=" + Math.random();
    } else {
        (new Image()).src = location.protocol + "//mp.weixin.qq.com/mp/jsmonitor?idkey=68064_10_1&r=" + Math.random();
    }

    var par = window.parent;

    var reg = /^http(s)?\:\/\/mp\.weixin\.qq\.com\/s/g;
    if (par == window || !/mp\.weixin\.qq\.com$/.test(par.location.host)){
        
    }
    
    function doLog(method, msg){

        var w;
        var WeixinJSBridge;
        var doc = {};
        if (top != window) {
            w = top.window;
        } else {
            w = window;
        }
        try { 
            WeixinJSBridge = w.WeixinJSBridge;
            doc = w.document;
        } catch(e) {}

        
        if(!!method && !!WeixinJSBridge && !!WeixinJSBridge.invoke){
            
            WeixinJSBridge.invoke(method, {
                "level" : 'info',
                "msg" : "[WechatFe] " + msg
            });
        }else{
            
            setTimeout(function(){
                if( doc.addEventListener ){
                    doc.addEventListener('WeixinJSBridgeReady', function(){
                        doLog(method,msg)
                    }, false);
                }else if (doc.attachEvent){
                    doc.attachEvent('WeixinJSBridgeReady', function(){
                        doLog(method, msg)
                    }); 
                    doc.attachEvent('onWeixinJSBridgeReady', function(){
                        doLog(method, msg)
                    });
                }
            }, 0)
        }
    }
    function logClientLog(msg){
        try{
            var method;
            if(/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)){
                method = 'writeLog';
            }else if(/(Android)/i.test(navigator.userAgent)){
                method = 'log';
            }
            if(!!method)
                doLog(method, msg);
        }catch(e){
            console.error(e)
            throw e
        }
    }

    
    (function(){

        var w;
        var WeixinJSBridge;
        if (top != window) {
            w = top.window;
        } else {
            w = window;
        }
        try { 
            WeixinJSBridge = w.WeixinJSBridge;
        } catch(e) {}

        var imgsSrc = [];
        function reviewImage(src) {
            if (typeof WeixinJSBridge != 'undefined') {
                WeixinJSBridge.invoke('imagePreview', {
                    'current' : src,
                    'urls' : imgsSrc
                });
            }
        }
        function onImgLoad() {
            var imgs = document.getElementsByTagName("img")||[];
            for( var i=0,l=imgs.length; i<l; i=i+2){
                var img = imgs.item(i);
                var src = img.getAttribute('data-src') || img.getAttribute('src');

                if( src ){
                    if ( src.indexOf("http://mmbiz.qpic.cn") == 0){
                        src = src.replace(/\/300$/, "/0");
                        src = src.replace(/\/300\?/, "/0?");
                    }
                    imgsSrc.push(src);
                    (function(src){
                        if (img.addEventListener){
                            img.addEventListener('click', function(){
                                reviewImage(src);
                            },false);
                        }else if(img.attachEvent){
                            img.attachEvent('click', function(){
                                reviewImage(src);
                            },false);
                        }
                    })(src);
                }
            }
        }
        if( window.addEventListener ){
            window.addEventListener('load', onImgLoad, false);
        }else if(window.attachEvent){
            window.attachEvent('load', onImgLoad);
            window.attachEvent('onload', onImgLoad);
        }
    })();
    function domload(){
        template.helper("toFixed", function(num){
            num = num.toString();
            var idx = num.indexOf('.');
            if (idx == -1){
                return num;
            }
            return num.substr(0,idx);
        });
        var Z = Zepto;
        function afterVote(){
            if(ret !== '0'){
                return ;
            }
            Z("#js_form").html(template.render("t_votes", voteInfo));
            if(par.iframe_reload){
                par.iframe_reload(window);
            }
        }
        afterVote();
        logClientLog('[Vote] render ok');
        Z(".js_vote").change(function(){
            if(Z(".js_vote:checked").length > 0){
                Z("#js_btn").removeClass("btn_disabled");
            }
            else{
                Z("#js_btn").addClass("btn_disabled");
            }
        });

        var has_click_vote = false;
        Z("#js_btn").click(function(){
            if (!voteInfo.is_login || has_click_vote) {
                return false;
            }
            logClientLog('[Vote] click vote');
            var values = [];
            
            var len = subject.length;
            for (var i = 0; i < len; i++) {
                var temp = [],eles = $('input[name=vote_'+i+']:checked');

                if(eles.length>0){
                    $('input[name=vote_'+i+']:checked').each(function(index,ele){
                        temp.push(ele.value);
                    })
                    values.push({
                        vote_id : subject[i].vote_id,
                        item_idx_list : {
                            item_idx:temp
                        }
                    })
                }else{
                    alert('请先完成所有问题');
                    return false;
                }

            };
            
            has_click_vote = true;
            var _idx = '1',
                _mid = '2247488232',
                _wxtoken = '777',
                _reprint_ticket = 'DrTV7SsGTT+mMs3+irGLTj56jeIAOL/v3fXrlEsobhtTOi5sAWjuKZyt6j8MnG+d',
                _source_mid = '2247490605',
                _source_idx = '2',
                _data = {
                    action:'vote',
                    __biz:'MzUxMTAxODE5NA==',
                    uin:'',
                    key:'',
                    pass_ticket:'Lc7sQ6hRZ4rj9ESG2SkC6DxzZ8BAmi23db6tPGllZbwsOYlqpzl39pwrACv5gWGo',
                    appmsg_token:'',
                    f:'json',
                    json:JSON.stringify({
                        "super_vote_item":values,
                        "super_vote_id":voteInfo.super_vote_id
                    })
                };
            _idx && (_data["idx"] = _idx);
            _mid && (_data["mid"] = _mid);
            _wxtoken && (_data["wxtoken"] = _wxtoken);
            _reprint_ticket && (_data["reprint_ticket"] = _reprint_ticket);
            _source_mid && (_data["source_mid"] = _source_mid);
            _source_idx && (_data["source_idx"] = _source_idx);
            if(!!_data.appmsg_token){
                (new Image()).src = location.protocol + "//mp.weixin.qq.com/mp/jsmonitor?idkey=68064_11_1&r=" + Math.random();
            } else {
                (new Image()).src = location.protocol + "//mp.weixin.qq.com/mp/jsmonitor?idkey=68064_12_1&r=" + Math.random();
            }
            Z.ajax({
                url:'/mp/newappmsgvote',
                data:_data,
                dataType:'json',
                type:'post',
                success:function(res){
                    logClientLog('[Vote] ajax res' + res.base_resp.ret);
                    if (res.base_resp && res.base_resp.ret == 0){
                        
                        for (var i = 0; i < subject.length; i++) {

                            for (var j = 0; j < subject[i].options.length; j++) {
                                if($('input[name=vote_'+i+']').eq(j).is(':checked')){
                                    subject[i].options[j].selected = true;
                                    subject[i].options[j].cnt++;
                                    subject[i].total_cnt ++;
                                }
                            };
                        };
                        voteInfo.has_vote = 1;
                        has_click_vote = false;
                        afterVote();
                    }else if(res.base_resp && res.base_resp.ret == -7){
                        has_click_vote = false;
                        alert('关注公众号后才可以投票');
                    }else if(res.base_resp && res.base_resp.ret == -6){
                        has_click_vote = false;
                        alert('投票过于频繁，请稍后重试！');
                    }else if(res.base_resp && res.base_resp.ret == 166001){
                         alert('投票已过期！');
                    }else if(res.base_resp && res.base_resp.ret == 166002){
                        alert('投票已删除！');
                    }else{
                        has_click_vote = false;
                        alert('投票失败，请稍后重试!');
                    }
                },
                error:function(){
                    has_click_vote = false;
                    alert('投票失败，请稍后重试!');
                }
            });
        });
    }
    function getParam(key, s){
        var s = s || location.href;
        var key = key.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&"); 
        var match = s.match(new RegExp("[?&]"+key+"=([^&]+)(&|$)"));
        return match && decodeURIComponent(match[1].replace(/\+/g, " "));
    }
    var voteInfo={"title":"你支持集中打印吗？","vote_permission":1,"expire_time":1531152049,"total_person":1827,"vote_subject":[{"type":1,"title":"你支持集中打印吗？","options":[{"name":"支持！有利于管理","cnt":107,"selected":false},{"name":"反对！费时，费力","cnt":1596,"selected":false},{"name":"无所谓","cnt":124,"selected":false}],"total_cnt":1827,"vote_id":488167402}],"super_vote_id":488167383,"del_flag":0};
    var ret = '0';
    var pass_ticket = "Lc7sQ6hRZ4rj9ESG2SkC6DxzZ8BAmi23db6tPGllZbwsOYlqpzl39pwrACv5gWGo";
    if(ret !== '0'){
        alert('参数错误');
    }
    else{
       if(voteInfo){


            
            var expire_time = voteInfo.expire_time ? voteInfo.expire_time*1000 : 0;
            voteInfo.is_expired = (expire_time - (+new Date()))>0 ? 0 : 1;
            
            var subject = voteInfo.vote_subject;
            voteInfo.vote_count = subject ? subject.length : 0;
            var option  = subject[0]['options'],s_len = option.length;
            var has_vote = false;
            for (var i = 0; i < s_len; i++) {
                if(option[i].selected == true){
                    has_vote = true;
                }
            }
            voteInfo.has_vote = has_vote;
            
            voteInfo.is_login = 1 ? 0 : 1;
            





            voteInfo.super_vote_id = voteInfo.super_vote_id ? voteInfo.super_vote_id : getParam('supervoteid');

            
            !!domload && (domload());
            domload = null;
        }

    }
</script>

    


</body></html>
<!--tailTrap<body></body><head></head><html></html>-->